<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>VR Explorer 2</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <script src="https://cdn.jsdelivr.net/npm/webxr-polyfill@latest/build/webxr-polyfill.js"></script>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <style>
        /* --- General Reset & Fonts --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            color: #333;
            overflow: hidden; 
            overscroll-behavior: none;
            touch-action: none; 
        }

        /* --- Force Hide VR Button Initially --- */
        .a-enter-vr { display: none !important; }
        .show-vr-button .a-enter-vr { display: block !important; }

        /* --- UI Overlay Layer --- */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Lifts UI up */
            justify-content: flex-start; 
            padding-top: 10vh; 
            text-align: center;
            box-sizing: border-box;
            transition: opacity 0.5s ease;
        }

        /* --- Typography --- */
        h1.main-title {
            font-size: 3.5rem;
            font-style: italic;
            font-weight: 700;
            margin-bottom: 50px;
            color: #007BFF;
            letter-spacing: -1px;
        }

        /* --- Dropdown Styling --- */
        .dropdown-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px; 
            width: 100%;
            max-width: 800px;
        }

        @media (min-width: 768px) {
            .dropdown-container {
                flex-direction: row;
                justify-content: center;
            }
        }

        .custom-select-wrapper {
            position: relative;
            user-select: none;
            width: 100%;
            max-width: 350px;
            margin: 0 auto;
        }

        .custom-select {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .custom-select__trigger {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 22px;
            font-size: 1.1rem;
            font-weight: 500;
            color: #333;
            height: 60px;
            line-height: 60px;
            background: #ffffff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .custom-select__trigger:hover {
            border-color: #007BFF;
        }

        .arrow {
            position: relative;
            height: 10px;
            width: 10px;
        }

        .arrow::after {
            content: '';
            position: absolute;
            top: 0;
            border-bottom: 2px solid #333;
            border-right: 2px solid #333;
            height: 100%;
            width: 100%;
            transform: rotate(45deg);
            transition: transform 0.2s;
        }

        .open .arrow::after {
            transform: rotate(225deg);
            top: 5px;
        }

        .custom-options {
            position: absolute;
            display: block;
            top: 100%;
            left: 0;
            right: 0;
            border: 2px solid #e0e0e0;
            border-top: 0;
            background: #fff;
            transition: all 0.3s;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 2;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .open .custom-options {
            opacity: 1;
            visibility: visible;
            pointer-events: all;
            margin-top: 5px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .option {
            position: relative;
            display: block;
            padding: 0 22px;
            font-size: 1rem;
            font-weight: 400;
            color: #333;
            line-height: 50px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .option:last-child {
            border-bottom: none;
        }

        .option:hover {
            background-color: #f7f7f7;
            font-weight: 600;
        }

        /* --- Footer Styling --- */
        .footer-text {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }
        
        .footer-small {
            font-size: 0.8rem;
            color: #999;
            margin-top: 40px; 
        }

        /* --- Install Button --- */
        #install-btn {
            display: none; 
            margin-top: 20px;
            padding: 12px 24px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* --- Exit Controls --- */
        #exit-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 9998;
            display: none;
        }

        .btn-exit {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 1rem;
            backdrop-filter: blur(5px);
        }

        @media (max-width: 600px) {
            h1.main-title { font-size: 2.5rem; }
            .custom-select__trigger { font-size: 1rem; }
        }

    </style>
</head>
<body>

    <div id="ui-layer">
        <h1 class="main-title">VR Explorer 2</h1>

        <div class="dropdown-container">
            <div class="custom-select-wrapper">
                <div class="custom-select" id="dd-presentation">
                    <div class="custom-select__trigger">
                        <span>Presentation Simulations</span>
                        <div class="arrow"></div>
                    </div>
                    <div class="custom-options" id="options-presentation"></div>
                </div>
            </div>

            <div class="custom-select-wrapper">
                <div class="custom-select" id="dd-special">
                    <div class="custom-select__trigger">
                        <span>Special Simulations</span>
                        <div class="arrow"></div>
                    </div>
                    <div class="custom-options" id="options-special"></div>
                </div>
            </div>
        </div>

        <div class="footer-text">For course material, treatment plan, tutorials, and feedback visit CambridgeVR.com</div>
        <button id="install-btn">Install App</button>
        <div class="footer-text footer-small">VR Explorer 2.05 brought to you by Cambridge VR</div>
    </div>

    <div id="exit-controls">
        <button class="btn-exit" onclick="exitSimulation()">‚Üê Exit Simulation</button>
    </div>

    <a-scene 
        id="main-scene"
        embedded 
        loading-screen="enabled: false" 
        renderer="antialias: true; colorManagement: true;"
        vr-mode-ui="enabled: false">
        
        <a-assets>
            <video id="video-360" loop crossorigin="anonymous" playsinline webkit-playsinline></video>
        </a-assets>
        
        <a-videosphere src="#video-360" rotation="0 -90 0"></a-videosphere>

        <a-entity position="0 0 0">
            <a-camera look-controls="reverseMouseDrag: false; touchEnabled: true" wasd-controls="enabled: false"></a-camera>
        </a-entity>
    </a-scene>

    <script>
        const presentationVideos = [
            { title: "Audience of 0", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N0-CF.h264.mp4" },
            { title: "Audience of 1", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N1-CF.h264.mp4" },
            { title: "Audience of 2", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N2-CF.h264.mp4" },
            { title: "Audience of 4", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N4-CF.h264.mp4" },
            { title: "Audience of 9", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N9-CF.h264.mp4" },
            { title: "Audience of 16", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N16-CF.h264.mp4" },
            { title: "Audience of 25", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N25-CF.h264.mp4" },
            { title: "Audience of 50", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N50-CF.h264.mp4" },
            { title: "Audience of 100", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N100-CF.h264.mp4" },
            { title: "Audience of 200", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N200-CF.mp4" },
            { title: "Audience of 500", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N500-CF.h264.mp4" },
            { title: "Audience of 1000s", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N10K-CF.h264.mp4" }
        ];

        const specialVideos = [
            { title: "TV teleprompter", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/ACC01-CF.h264.mp4" },
            { title: "Job interview", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/JIC01-CF.h264.mp4" },
            { title: "Radio interview", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/RIC01-CF.h264.mp4" },
            { title: "Standing crowd", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/SA01-CF.mp4" },
            { title: "Distracting room", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/DA01-CF.mp4" },
            { title: "Pitching panel 1", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/PP01-CF.mp4" },
            { title: "Pitching panel 2", url: "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/PP02-CF.mp4" }
        ];

        const videoEl = document.getElementById('video-360');
        const uiLayer = document.getElementById('ui-layer');
        const exitControls = document.getElementById('exit-controls');
        const sceneEl = document.getElementById('main-scene');
        const installBtn = document.getElementById('install-btn');
        let deferredPrompt;

        // Init Polyfill
        window.webxrPolyfill = new WebXRPolyfill();

        // PWA Install Logic
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('Install Prompt Event Fired');
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
        });

        installBtn.addEventListener('click', (e) => {
            installBtn.style.display = 'none';
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                });
            }
        });

        function init() {
            populateDropdown('options-presentation', presentationVideos);
            populateDropdown('options-special', specialVideos);
            setupDropdownListeners();

            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    navigator.serviceWorker.register('sw.js').catch(function(err) {
                        console.log('SW failed: ', err);
                    });
                });
            }
        }

        function populateDropdown(elementId, videos) {
            const container = document.getElementById(elementId);
            videos.forEach(vid => {
                const option = document.createElement('span');
                option.className = 'option';
                option.textContent = vid.title;
                option.onclick = function(e) {
                    e.stopPropagation();
                    startSimulation(vid.url);
                    closeAllSelect();
                };
                container.appendChild(option);
            });
        }

        function setupDropdownListeners() {
            const wrappers = document.querySelectorAll('.custom-select-wrapper');
            wrappers.forEach(wrapper => {
                const select = wrapper.querySelector('.custom-select');
                select.addEventListener('click', function() {
                    this.classList.toggle('open');
                });
            });

            window.addEventListener('click', function(e) {
                if (!e.target.closest('.custom-select')) {
                    closeAllSelect();
                }
            });
        }

        function closeAllSelect() {
            document.querySelectorAll('.custom-select').forEach(el => el.classList.remove('open'));
        }

        function startSimulation(url) {
            videoEl.src = url;
            videoEl.play().catch(e => console.error("Play error:", e));

            uiLayer.style.opacity = '0';
            setTimeout(() => {
                uiLayer.style.display = 'none';
                exitControls.style.display = 'block';
                document.body.classList.add('show-vr-button');
                sceneEl.setAttribute('vr-mode-ui', 'enabled: true');
            }, 500);
        }

        window.exitSimulation = function() {
            videoEl.pause();
            videoEl.src = ""; 
            if (sceneEl.is('vr-mode')) sceneEl.exitVR();
            document.body.classList.remove('show-vr-button');
            sceneEl.setAttribute('vr-mode-ui', 'enabled: false');
            exitControls.style.display = 'none';
            uiLayer.style.display = 'flex';
            setTimeout(() => { uiLayer.style.opacity = '1'; }, 10);
        }

        init();
    </script>
</body>
</html>
